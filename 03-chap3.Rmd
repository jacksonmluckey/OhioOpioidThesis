# Results

All models include year fixed effects.

## Model Design

```{r regressionFormulaFunction}
regression_formula <- function(rate_variable, income_variable, fixed_effects=NULL) {
  
  # check that rate_variable is valid
  if(!rate_variable %in% c("`Fatal Overdose Crude Rate`",
                          "`Fatal Overdose Age-Adjusted Rate`",
                          "`Fatak Overdose Modeled Rate`",
                          "`Fatal Overdose Rate (Includes Imputed)`")) {
    stop(rate_variable, " is not a valid fatal overdose rate variable. Did you forget to wrap it in ``s like `Fatal Overdose Crude Rate`?")
  }
  
  # check that income_variable is valid
  if(!income_variable %in% c("`Median Individual Income`",
                             "`Median Household Income`")) {
    stop(income_variable, " is not a valid income variable. Did you forget to wrap it in ``s like `Median Individual Income`?")
  }
  
  # excludes 1 from each category (currently 5 and under for both sexes, highschool or less for education)
  formula_base <- paste(
    "`Prescribing Rate`",
    "`Density`",
    "`Percent Black`",
    "`Percent with Some College`",
    "`Percent with Bachelors or More`",
    "`Percent of Males Aged Under 5 with a Disability`",
    "`Percent of Males Aged 5 to 17 with a Disability`",
    "`Percent of Males Aged 18 to 34 with a Disability`",
    "`Percent of Males Aged 35 to 64 with a Disability`",
    "`Percent of Males Aged 65 to 74 with a Disability`",
    "`Percent of Males Aged 75 and Up with a Disability`",
    "`Percent of Females Aged Under 5 with a Disability`",
    "`Percent of Females Aged 5 to 17 with a Disability`",
    "`Percent of Females Aged 18 to 34 with a Disability`",
    "`Percent of Females Aged 35 to 64 with a Disability`",
    "`Percent of Females Aged 65 to 74 with a Disability`",
    "`Percent of Females Aged 75 and Up with a Disability`",
    sep = " + "
  )
  
  # add fixed effects if they're provided
  if(is.null(fixed_effects)) {
    
    regression_formula <- as.formula(paste0(rate_variable, " ~ ", income_variable, " + ", formula_base))
    
  } else {
    
    regression_formula <- as.formula(paste0(rate_variable, " ~ ", income_variable, " + ", formula_base, " + ", fixed_effects))
    
  }
  
  
  # return formula
  regression_formula
  
}
```

```{r produceRegressionFormulas}
# crude rate
crude_rate_formula <- regression_formula("`Fatal Overdose Crude Rate`", "`Median Household Income`", "Year")
crude_rate_acs1 <- lm(crude_rate_formula, df_acs1)
crude_rate_acs5 <- lm(crude_rate_formula, df_acs5)

# age adjusted rate
age_adjusted_rate_formula <- regression_formula("`Fatal Overdose Age-Adjusted Rate`", "`Median Household Income`", "Year")
age_adjusted_rate_acs1 <- lm(age_adjusted_rate_formula, df_acs1)
age_adjusted_rate_acs5 <- lm(age_adjusted_rate_formula, df_acs5)

# with imputed values
imputed_formula <- regression_formula("`Fatal Overdose Rate (Includes Imputed)`", "`Median Household Income`", "Year")
imputed_acs1 <- lm(imputed_formula, df_acs1)
imputed_acs5 <- lm(imputed_formula, df_acs5)

# individual income
crude_rate_formula_individual_income <- regression_formula("`Fatal Overdose Crude Rate`", "`Median Individual Income`", "Year")
crude_rate_individual_acs1 <- lm(crude_rate_formula_individual_income, df_acs1)
crude_rate_individual_acs5 <- lm(crude_rate_formula_individual_income, df_acs5)

# with county Fixed Effects
county_FE_formula <- regression_formula("`Fatal Overdose Crude Rate`", "`Median Household Income`", "Year + County")
county_FE_acs1 <- lm(county_FE_formula, df_acs1)
county_FE_acs5 <- lm(county_FE_formula, df_acs5)
```

### Household vs Individual Income

```{r doHouseholdAndIndividualIncomeDiffer, results="asis"}
# show that household and individual are not significantly different
stargazer(
  crude_rate_acs1,
  crude_rate_individual_acs1,
  crude_rate_acs5,
  crude_rate_individual_acs5,
  covariate.labels = c(
    "Median Household Income",
    "Median Individual Income",
    "Prescribing Rate",
    "Density: Small Metro",
    "Density: Micropolitan",
    "Density: Large Fring Metro",
    "Density: Medium Metro",
    "Density: Large Central Metro",
    "\\% Black",
    "\\% with Some College",
    "\\% with Bachelors or More",
    "\\% Disabled: Males Under 5",
    "\\% Disabled: Males 5 to 17",
    "\\% Disabled: Males 18 to 34",
    "\\% Disabled: Males 35 to 64",
    "\\% Disabled: Males 65 to 74",
    "\\% Disabled: Males 75 and Up",
    "\\% Disabled: Females Under 5",
    "\\% Disabled: Females 5 to 17",
    "\\% Disabled: Females 18 to 34",
    "\\% Disabled: Females 35 to 64",
    "\\% Disabled: Females 65 to 74",
    "\\% Disabled: Females 75 and Up"
  ),
  title = "Does Individual vs Household Income Significantly Change the Model?",
  omit = c("Year", "Constant"),
  column.labels = c("ACS1 Household", "ACS1 Individual", "ACS5 Household", "ACS5 Individual"),
  single.row = TRUE,
  float.env = "sidewaystable",
  sep.width = 0,
  font.size = "small",
  header = FALSE
)
```

Table 3.1 examines how the model changes when individual income is substituted for household income. As will be seen throughout this chapter, changing between the American Community Survey one year and five year estimates has the greatest impact on results. The coefficients for household and individual income point in opposite directions, but given the lack of statistical significance and the incredibly low magnitudes of the coefficients, it almost certainly meaningless. In general, switching between income types has minimal effects on the coefficients within a survey. Moving from household to individual income makes `percent black` significant for one year estimates, but `percent black` is significant with both five year estimate models. The same is true for the `percent with a bachelors degree or more` variable. The `percent of males aged 35 to 64 with a disability` is significant with household and not individual income for one year estimates, but is significant with both income measures when using five year estimates. Due to household income intuitively seeming more relevant than indidividual income and there not being a clear statistical advantage of either variable, future models will use household income.

In all four model specifications, an increase in the opioid prescribing rate is associated with an increase in the fatal opioid overdose rate.


### One Year vs Five Year Estimates

```{r doACS1ACS5Differ, results="asis"}
stargazer(
  crude_rate_acs1,
  crude_rate_acs5,
  covariate.labels = c(
    "Median Household Income",
    "Prescribing Rate",
    "Density: Small Metro",
    "Density: Micropolitan",
    "Density: Large Fring Metro",
    "Density: Medium Metro",
    "Density: Large Central Metro",
    "\\% Black",
    "\\% with Some College",
    "\\% with Bachelors or More",
    "\\% Disabled: Males Under 5",
    "\\% Disabled: Males 5 to 17",
    "\\% Disabled: Males 18 to 34",
    "\\% Disabled: Males 35 to 64",
    "\\% Disabled: Males 65 to 74",
    "\\% Disabled: Males 75 and Up",
    "\\% Disabled: Females Under 5",
    "\\% Disabled: Females 5 to 17",
    "\\% Disabled: Females 18 to 34",
    "\\% Disabled: Females 35 to 64",
    "\\% Disabled: Females 65 to 74",
    "\\% Disabled: Females 75 and Up"
  ),
  title = "Do ACS1 and ACS5 Produce Comparable Results?",
  omit = c("Year", "Constant"),
  column.labels = c("ACS1", "ACS5"),
  single.row = TRUE,
  font.size = "small",
  header = FALSE
)
```

Table 3.3 examines the differences between modeling with American Community Survey one year and five year estimates. `ACS1` refers to the one year estimates, whereas `ACS5` refers to the five year estimates. There are several significant changes that occur when switching between one and five year estimates. For one, the coefficient for the `prescribing rate` goes down slightly when using five year estimates, although to a degree that is almost unnoticable. In both cases the `prescribing rate` is staistically significant at the 1% level. The significance and impact of the density level dummies changes as well. With one year estimates, medium density areas are associated with a significantly higher overdose rate. In contrast, density has a statistically significant protective effect when using five year estimates. This is likely due to the five year estimates containing more small, rural counties, which the literature suggested have the highest overdose rates in Ohio. The coefficient of "Percent Black" more than doubles when the five year estimates are used, and is only significant with that dataset. While the coefficient for `percent with a bachelors degree or more` is close to zero and statistically insignificant with one year estimates, it has a statistically significant protective effect when using five year estimates. With five year estimates, as the `percent of males aged 18 to 34 with a disability` rises, the fatal opioid overdose rate rises. The protective effect of the `percent of males aged 36 to 64 with a disability` increases in both magnitude and statistical significance when using five year estimates instead of one year estimates. With five year estimates, the `percent of males aged 65 to 74 with a disability` is associated with increased overdose deaths. Switching from one year to five year estimates increases the magnitude and statistical significance of the protective effect of disabilities among females aged under five and five to 17. Furthermore, using five year estimates increases the coefficient and significance of the `percent of females aged 35 to 64 with a disability` variable. Finally, the five year estimates have greater explanatory power than the one year estimates. Due to the increased explanatory power, I will be using the five year estimates throughout the rest of my thesis.

### Fatal Overdose Rate Metrics

```{r doCrudeAgeImputedDifferACS5, results="asis"}
stargazer(
  crude_rate_acs5,
  age_adjusted_rate_acs5,
  imputed_acs5,
  covariate.labels = c(
    "Median Household Income",
    "Prescribing Rate",
    "Density: Small Metro",
    "Density: Micropolitan",
    "Density: Large Fring Metro",
    "Density: Medium Metro",
    "Density: Large Central Metro",
    "\\% Black",
    "\\% with Some College",
    "\\% with Bachelors or More",
    "\\% Disabled: Males Under 5",
    "\\% Disabled: Males 5 to 17",
    "\\% Disabled: Males 18 to 34",
    "\\% Disabled: Males 35 to 64",
    "\\% Disabled: Males 65 to 74",
    "\\% Disabled: Males 75 and Up",
    "\\% Disabled: Females Under 5",
    "\\% Disabled: Females 5 to 17",
    "\\% Disabled: Females 18 to 34",
    "\\% Disabled: Females 35 to 64",
    "\\% Disabled: Females 65 to 74",
    "\\% Disabled: Females 75 and Up"
  ),
  title = "How does the type of overdose rate metric influence the results?",
  omit = c("Year", "Constant"),
  column.labels = c("Crude", "Age-Adjusted", "Imputed"),
  single.row = TRUE,
  float.env = "sidewaystable",
  sep.width = 0.5,
  font.size = "small",
  header = FALSE
)
```

Table 3.4 shows the differences between using the crude fatal overdose rate, the age-adjusted fatal overdose rate, and the imputed overdose rate. While there are minor differences between these model specifications, they all return very similar results. The crude and imputed models include approximately 100 more observations than the age-adjusted model, which makes it difficult to separate out the influence of using an age-adjusted rate from the influence of decreased observations. Adjusting the fatal overdose rate for age decreases the signficiance of the prescribing rate to the 10% level from the 1% level. With all three models, the prescribing rate has a small, but significant, protective effect. Using the age-adjusted fatal overdose rate increases the protective effect of population density on fatal overdoses, but decreases the significance of that effect. This probably means that there is correlation between the age distribution of a county and its population density. Using the age-adjusted rate makes all male disability rates insignificant, and increases the impact of female disability rates. This may be correlated with the disability rates being broken down into age bins. The imputed rate produces results are almost identical to the crude rate results. This is unsuprising, as the imputed rate is simply the crude rate with a few more observations. Given that using the age-adjusted rate reduces the number of observations significantly, and the imputed rate only provides two more observations while significantly complicating the dependent variable, the rest of this thesis will use the crude rate.

### County Fixed Effects

```{r doCountyFixedEffectsMatter, results="asis"}
stargazer(
  crude_rate_acs1,
  county_FE_acs1,
  crude_rate_acs5,
  county_FE_acs5,
  covariate.labels = c(
    "Median Household Income",
    "Prescribing Rate",
    "Density: Small Metro",
    "Density: Micropolitan",
    "Density: Large Fring Metro",
    "Density: Medium Metro",
    "Density: Large Central Metro",
    "\\% Black",
    "\\% with Some College",
    "\\% with Bachelors or More",
    "\\% Disabled: Males Under 5",
    "\\% Disabled: Males 5 to 17",
    "\\% Disabled: Males 18 to 34",
    "\\% Disabled: Males 35 to 64",
    "\\% Disabled: Males 65 to 74",
    "\\% Disabled: Males 75 and Up",
    "\\% Disabled: Females Under 5",
    "\\% Disabled: Females 5 to 17",
    "\\% Disabled: Females 18 to 34",
    "\\% Disabled: Females 35 to 64",
    "\\% Disabled: Females 65 to 74",
    "\\% Disabled: Females 75 and Up"
  ),
  title = "Do county fixed effects improve the model?",
  omit = c("Year", "County", "Constant"),
  column.labels = c("ACS1 without FE", "ACS1 with FE", "ACS5 without FE", "ACS5 with FE"),
  single.row = TRUE,
  float.env = "sidewaystable",
  sep.width = 0,
  font.size = "small",
  header = FALSE
)
```

Table 3.6 examines whether or not including county fixed effects improves the model. Going off the R squared values, including county fixed effects increases the explanatory power of the model by a little over 50%. As before, the five year estimates have greater explanatory power than the one year estimates. With five year estimates and county fixed effects, the model is able to explain over 80% of the variation in the fatal overdose rate.

#### Test for County Joint Significance

## Further Testing

In order to address potential data censoring, I also tried running a Tobit model, which is a form of censored regression. I was unable to get tobit estimates, however, due to the large number of independent variables relative to the number of observations. Regressions ran with fewer variables did converge, however, and showed no signficiant differences between an OLS and censored regression model. This indicates that there is little to no censoring in the data.

obtain the squared OLS residuals
replace dependent variable with squared residuals
squared residuals = estimate of variance of each observation
looking to see if variance is significantly associated with any variables in underlying model
heteroskedacity = variance associated with variables
in an ideal world, there are no significant t-statistics with this
otherwise, there is heteroskedacity
take the R^2 from 2nd regression and multiply by number of observations
that becomes LM statistic
which is distributed chi^2 with K degrees of freedom
estimating 22 parameters including constant (K degrees of freedom)
if R2 * 160 >  then reject null hypothesis of homoskedastic errors
test is valid under the null (null = absence of pathology)
reject the null => accept the pathology
cluster SE at level of county (look into how to do with R)
   -> subset of robust SE
   -> controls for some counties having more predictable overdose deaths
with 160 observations and K-DoF of 22

Heteroskedacity test. Robust standard errors (clustered).

Fixed effects: https://www.econometrics-with-r.org/10-3-fixed-effects-regression.html

```{r tobit, eval=FALSE}
# disabled because no censored regressions
crude_rate_household <- regression_formula("`Fatal Overdose Age-Adjusted Rate`", "`Median Household Income`")
crude_rate_household_FE <- regression_formula("`Fatal Overdose Age-Adjusted Rate`", "`Median Household Income`", "Year")
# picked left basically at random to get rid of "there are no censored observations" error
stargazer(censReg(crude_rate_household, data = df_acs1, logLikOnly = FALSE),
          censReg(crude_rate_household, data = df_acs5, logLikOnly = FALSE),
          censReg(crude_rate_household_FE, data = df_acs1, logLikOnly = FALSE),
          censReg(crude_rate_household_FE, data = df_acs5, logLikOnly = FALSE),
          covariate.labels = c(
    "Median Household Income",
    "Prescribing Rate",
    "Density: Small Metro",
    "Density: Micropolitan",
    "Density: Large Fring Metro",
    "Density: Medium Metro",
    "Density: Large Central Metro",
    "\\% Black",
    "\\% with Some College",
    "\\% with Bachelors or More",
    "\\% Disabled: Males Under 5",
    "\\% Disabled: Males 5 to 17",
    "\\% Disabled: Males 18 to 34",
    "\\% Disabled: Males 35 to 64",
    "\\% Disabled: Males 65 to 74",
    "\\% Disabled: Males 75 and Up",
    "\\% Disabled: Females Under 5",
    "\\% Disabled: Females 5 to 17",
    "\\% Disabled: Females 18 to 34",
    "\\% Disabled: Females 35 to 64",
    "\\% Disabled: Females 65 to 74",
    "\\% Disabled: Females 75 and Up"
  ),
          title = "Tobit: Age-Adjusted Rate on Household Income with and without Year Fixed Effects",
          dep.var.caption = "Fatal Overdose Rate (Age-Adjusted)",
          omit = "Year",
          column.labels = c("ACS1", "ACS5", "ACS1 with FE", "ACS5 with FE"),
          add.lines = list(c("Fixed Effects?", "No", "No", "Yes", "Yes")),
          single.row = TRUE,
          sep.width = 0,
          font.size = "small",
          float.env = "sidewaystable",
          header = FALSE)
```

## Policy Implications